!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ImageMasker=t():e.ImageMasker=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>a});var n=function(e,t,n,a){return new(n||(n=Promise))((function(o,i){function c(e){try{s(a.next(e))}catch(e){i(e)}}function r(e){try{s(a.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}s((a=a.apply(e,t||[])).next())}))};const a=function(e){return n(this,void 0,void 0,(function*(){let t=!1;const a="rgba(0,0,0,1)",o={mode:"draw",shape:"free",brushSize:5,color:"rgba(255, 0, 0, 1)",width:0,height:0,undoAble:!1,redoAble:!1,undo:function(){i.length>1&&(c.push(i.pop()),u(i[i.length-1]),o.redoAble=!0,o.undoAble=i.length>1)},redo:function(){if(c.length>0){const e=c.pop();i.push(e),u(e),o.redoAble=c.length>0,o.undoAble=!0}},maskLayerToDataURL:function(){return n(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{o.canvas&&o.ctx?e(o.canvas.toDataURL()):t(new Error("Canvas or ctx is not defined"))}))}))},toDataURL:function(){return n(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{if(!o.canvas||!o.ctx||!o.originalImage)return void t(new Error("Canvas or ctx or originalImage is not defined"));const n=o.canvas.toDataURL(),a=new Image;a.onload=()=>{o.ctx.drawImage(o.originalImage,0,0,o.width,o.height),o.ctx.drawImage(a,0,0);const t=o.canvas.toDataURL();o.ctx.clearRect(0,0,o.width,o.height),o.ctx.drawImage(a,0,0),e(t)},a.src=n}))}))}},i=[],c=[],r=e=>{if(o.canvas&&o.ctx&&0===e.button)switch(t=!0,d=e.clientX-o.canvas.getBoundingClientRect().left,g=e.clientY-o.canvas.getBoundingClientRect().top,o.shape){case"free":o.ctx.beginPath(),o.ctx.moveTo(d,g);break;case"rect":p(e);break;case"oval":h(e)}},s=e=>{if(t)switch(o.shape){case"free":!function(e){if(!o.canvas||!o.ctx)return;const t=o.ctx.globalCompositeOperation;"erase"===o.mode&&(o.ctx.globalCompositeOperation="destination-out");const n=o.canvas.getBoundingClientRect(),i=e.clientX-n.left,c=e.clientY-n.top;o.ctx.lineTo(i,c),o.ctx.strokeStyle="erase"===o.mode?a:o.color,o.ctx.lineWidth=o.brushSize,o.ctx.stroke(),"erase"===o.mode&&(o.ctx.globalCompositeOperation=t)}(e);break;case"rect":p(e);break;case"oval":h(e)}},l=e=>{o.canvas&&o.ctx&&0===e.button&&(t=!1,o.imageData=o.ctx.getImageData(0,0,o.width,o.height),c.length=0,i.push(o.imageData),o.redoAble=!1,o.undoAble=!0)};let d,g;function u(e){e&&(o.imageData=e,o.ctx.putImageData(e,0,0))}function p(e){if(!o.canvas||!o.ctx||!o.imageData)return;const t=o.ctx.globalCompositeOperation;"erase"===o.mode&&(o.ctx.globalCompositeOperation="destination-out"),u(o.imageData);const n=o.canvas.getBoundingClientRect(),i=e.clientX-n.left,c=e.clientY-n.top;o.ctx.fillStyle="erase"===o.mode?a:o.color;const r=i-d,s=c-g;o.ctx.fillRect(d,g,r,s),"erase"===o.mode&&(o.ctx.globalCompositeOperation=t)}function h(e){if(!o.canvas||!o.ctx||!o.imageData)return;u(o.imageData);const t=o.ctx.globalCompositeOperation;"erase"===o.mode&&(o.ctx.globalCompositeOperation="destination-out");const n=o.canvas.getBoundingClientRect(),i=e.clientX-n.left,c=e.clientY-n.top;o.ctx.fillStyle="erase"===o.mode?a:o.color,o.ctx.beginPath(),o.ctx.ellipse((d+i)/2,(g+c)/2,Math.abs(i-d)/2,Math.abs(c-g)/2,0,0,2*Math.PI),o.ctx.fill(),"erase"===o.mode&&(o.ctx.globalCompositeOperation=t)}const m=e.parentElement instanceof HTMLElement?e.parentElement:document.getElementById(e.parentElement);if(!m)throw new Error("Please provide a valid parent element");m.innerHTML="";const f=document.createElement("div");f.style.background=e.background||"#000",f.style.padding=e.padding||"4px",f.style.display="flex",f.style.justifyContent="center",f.style.alignItems="center",f.style.width=m.clientWidth+"px",f.style.height=m.clientHeight+"px",f.style.flex="1",m.appendChild(f);const{width:x,height:v}=function(e){const t=e.getBoundingClientRect(),n=window.getComputedStyle(e),a=parseFloat(n.paddingLeft||"0"),o=parseFloat(n.paddingRight||"0"),i=parseFloat(n.paddingTop||"0"),c=parseFloat(n.paddingBottom||"0");return{width:t.width-(a+o),height:t.height-(i+c)}}(f);return new Promise((t=>{const n=new Image;n.onload=function(){const n=function(e,t,n,a){const o=Math.min(n/t.width,a/t.height),i=t.width*o,c=t.height*o,d=document.createElement("canvas");d.style.backgroundImage=`url(${t.src})`,d.style.backgroundSize="100% 100%",d.width=i,d.height=c,e.appendChild(d);const g=d.getContext("2d",{willReadFrequently:!0});return e.appendChild(d),function(e){e.addEventListener("mousedown",(e=>{e.stopPropagation()})),e.addEventListener("mousemove",(e=>{e.stopPropagation()})),e.addEventListener("mouseup",(e=>{e.stopPropagation()})),e.addEventListener("click",(e=>{e.stopPropagation()})),e.addEventListener("mousedown",r),e.addEventListener("mousemove",s),e.addEventListener("mouseup",l)}(e),{canvas:d,ctx:g,width:i,height:c,originalImage:t}}(f,e.image,x,v);o.canvas=n.canvas,o.ctx=n.ctx,o.width=n.width,o.height=n.height,o.originalImage=n.originalImage,o.imageData=o.ctx.getImageData(0,0,o.width,o.height),i.push(o.imageData),t(o)},n.src=e.image.src}))}))};return t.default})()));