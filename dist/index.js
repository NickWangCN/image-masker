!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ImageMasker=t():e.ImageMasker=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>a});var n=function(e,t,n,a){return new(n||(n=Promise))((function(o,i){function c(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}l((a=a.apply(e,t||[])).next())}))};const a=function(e){return n(this,void 0,void 0,(function*(){let t=!1;const a="rgba(0,0,0,1)",o={enableDraw:!0,mode:"draw",shape:"free",brushSize:5,color:"rgba(255, 0, 0, 1)",width:0,height:0,undoAble:!1,redoAble:!1,undo:function(){i.length>1&&(c.push(i.pop()),m(i[i.length-1]),o.redoAble=!0,o.undoAble=i.length>1)},redo:function(){if(c.length>0){const e=c.pop();i.push(e),m(e),o.redoAble=c.length>0,o.undoAble=!0}},clear:function(){o.canvas&&o.ctx&&(o.ctx.clearRect(0,0,o.width,o.height),o.imageData=o.ctx.getImageData(0,0,o.width,o.height),c.length=0,i.push(o.imageData),o.redoAble=!1,o.undoAble=!0)},maskLayerToDataURL:function(){return n(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{o.canvas&&o.ctx?e(o.canvas.toDataURL()):t(new Error("Canvas or ctx is not defined"))}))}))},toDataURL:function(){return n(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{if(!o.canvas||!o.ctx||!o.originalImage)return void t(new Error("Canvas or ctx or originalImage is not defined"));const n=o.canvas.toDataURL(),a=new Image;a.onload=()=>{o.ctx.drawImage(o.originalImage,0,0,o.width,o.height),o.ctx.drawImage(a,0,0);const t=o.canvas.toDataURL();o.ctx.clearRect(0,0,o.width,o.height),o.ctx.drawImage(a,0,0),e(t)},a.src=n}))}))}},i=[],c=[];let r,l,s=null,d=null;const g=e=>{if(o.canvas&&o.ctx&&o.enableDraw&&0===e.button)switch(t=!0,r=e.clientX-o.canvas.getBoundingClientRect().left,l=e.clientY-o.canvas.getBoundingClientRect().top,s=r,d=l,o.shape){case"free":o.ctx.beginPath(),o.ctx.moveTo(r,l),u(r,l);break;case"rect":f(e);break;case"oval":x(e)}};function u(e,t){o.ctx&&(o.ctx.beginPath(),o.ctx.arc(e,t,o.brushSize/2,0,2*Math.PI),o.ctx.fillStyle="erase"===o.mode?a:o.color,o.ctx.fill())}const h=e=>{if(t)switch(o.shape){case"free":!function(e){if(!o.canvas||!o.ctx)return;const t=o.ctx.globalCompositeOperation;"erase"===o.mode&&(o.ctx.globalCompositeOperation="destination-out");const n=o.canvas.getBoundingClientRect(),a=e.clientX-n.left,i=e.clientY-n.top;if(null!==s&&null!==d){const e=a-s,t=i-d,n=Math.sqrt(e*e+t*t),c=o.brushSize/2;for(let a=0;a<n;a+=c){const o=a/n;u(s+o*e,d+o*t)}}u(a,i),s=a,d=i,"erase"===o.mode&&(o.ctx.globalCompositeOperation=t)}(e);break;case"rect":f(e);break;case"oval":x(e)}},p=e=>{o.canvas&&o.ctx&&o.enableDraw&&0===e.button&&(t=!1,o.imageData=o.ctx.getImageData(0,0,o.width,o.height),c.length=0,i.push(o.imageData),o.redoAble=!1,o.undoAble=!0,s=null,d=null)};function m(e){e&&(o.imageData=e,o.ctx.putImageData(e,0,0))}function f(e){if(!o.canvas||!o.ctx||!o.imageData)return;const t=o.ctx.globalCompositeOperation;"erase"===o.mode&&(o.ctx.globalCompositeOperation="destination-out"),m(o.imageData);const n=o.canvas.getBoundingClientRect(),i=e.clientX-n.left,c=e.clientY-n.top;o.ctx.fillStyle="erase"===o.mode?a:o.color;const s=i-r,d=c-l;o.ctx.fillRect(r,l,s,d),"erase"===o.mode&&(o.ctx.globalCompositeOperation=t)}function x(e){if(!o.canvas||!o.ctx||!o.imageData)return;m(o.imageData);const t=o.ctx.globalCompositeOperation;"erase"===o.mode&&(o.ctx.globalCompositeOperation="destination-out");const n=o.canvas.getBoundingClientRect(),i=e.clientX-n.left,c=e.clientY-n.top;o.ctx.fillStyle="erase"===o.mode?a:o.color,o.ctx.beginPath(),o.ctx.ellipse((r+i)/2,(l+c)/2,Math.abs(i-r)/2,Math.abs(c-l)/2,0,0,2*Math.PI),o.ctx.fill(),"erase"===o.mode&&(o.ctx.globalCompositeOperation=t)}const v=e.parentElement instanceof HTMLElement?e.parentElement:document.getElementById(e.parentElement);if(!v)throw new Error("Please provide a valid parent element");v.innerHTML="";const b=document.createElement("div");b.style.background=e.background||"#000",b.style.padding=e.padding||"4px",b.style.display="flex",b.style.justifyContent="center",b.style.alignItems="center",b.style.width=v.clientWidth+"px",b.style.height=v.clientHeight+"px",b.style.flex="1",v.appendChild(b);const{width:w,height:y}=function(e){const t=e.getBoundingClientRect(),n=window.getComputedStyle(e),a=parseFloat(n.paddingLeft||"0"),o=parseFloat(n.paddingRight||"0"),i=parseFloat(n.paddingTop||"0"),c=parseFloat(n.paddingBottom||"0");return{width:t.width-(a+o),height:t.height-(i+c)}}(b);return new Promise((t=>{const n=new Image;n.onload=function(){const n=function(e,t,n,a){const o=Math.min(n/t.width,a/t.height),i=t.width*o,c=t.height*o,r=document.createElement("canvas");r.style.backgroundImage=`url(${t.src})`,r.style.backgroundSize="100% 100%",r.width=i,r.height=c,e.appendChild(r);const l=r.getContext("2d",{willReadFrequently:!0});return e.appendChild(r),function(e){e.addEventListener("mousedown",(e=>{e.stopPropagation()})),e.addEventListener("mousemove",(e=>{e.stopPropagation()})),e.addEventListener("mouseup",(e=>{e.stopPropagation()})),e.addEventListener("click",(e=>{e.stopPropagation()})),e.addEventListener("mousedown",g),e.addEventListener("mousemove",h),e.addEventListener("mouseup",p)}(e),{canvas:r,ctx:l,width:i,height:c,originalImage:t}}(b,e.image,w,y);o.canvas=n.canvas,o.ctx=n.ctx,o.width=n.width,o.height=n.height,o.originalImage=n.originalImage,o.imageData=o.ctx.getImageData(0,0,o.width,o.height),i.push(o.imageData),t(o)},n.src=e.image.src}))}))};return t.default})()));